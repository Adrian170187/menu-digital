<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cocina - Men√∫ Digital</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body data-role="cocina">
    <header>
        <div class="container">
            <h1>üë®‚Äçüç≥ Pantalla de Cocina</h1>
            <div class="nav-links">
                <button onclick="App.auth.logout()"
                    style="background:none; color: var(--accent-color); font-size: 0.9rem; padding: 0;">Cerrar
                    Sesi√≥n</button>
            </div>
        </div>
    </header>

    <main class="container">
        <div id="orders-grid" class="grid">
            <p>Esperando pedidos...</p>
        </div>
    </main>

    <script src="js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Refresh logic
            setInterval(renderOrders, 2000); // Polling backup
            window.addEventListener('storage', () => {
                App.loadState();
                renderOrders();
            });
            window.addEventListener('orders-updated', renderOrders);
            window.addEventListener('order-placed', renderOrders); // For same-tab testing

            setTimeout(renderOrders, 500);

            function renderOrders() {
                const grid = document.getElementById('orders-grid');
                console.log("Rendering kitchen orders...", App.data.orders);

                // Sort by timestamp (newest first) and filter pending
                const activeOrders = [...App.data.orders]
                    .filter(o => o.status === 'pending')
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                if (activeOrders.length === 0) {
                    grid.innerHTML = '<p style="text-align:center; padding: 20px; opacity: 0.5;">No hay pedidos pendientes.</p>';
                    return;
                }

                grid.innerHTML = activeOrders.map(order => `
          <div class="card order-card" id="order-${order.id}" style="border-left: 5px solid var(--accent-color);">
            <div style="display:flex; justify-content:space-between; align-items: center;">
              <h2 style="margin:0;">Mesa ${order.tableId}</h2>
              <span style="font-size:0.85rem; background:#333; padding:4px 8px; border-radius:4px;">${new Date(order.timestamp).toLocaleTimeString()}</span>
            </div>
            <div style="margin: 15px 0;">
                <ul style="padding-left: 20px; font-size: 1.1rem; line-height: 1.6;">
                  ${order.items.map(item => `<li><strong>${item.name}</strong></li>`).join('')}
                </ul>
            </div>
            <button class="btn-primary" onclick="App.markOrderReady(${order.id})" style="width: 100%; padding: 12px;">‚úÖ Listo para servir</button>
          </div>
        `).join('');
            }
        });
    </script>
</body>

</html>